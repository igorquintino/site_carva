<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CARVA</title>
  <link rel="preload" as="fetch" href="./logo3dpreta.gltf" crossorigin>
  <style>
    :root{ --bg:#ffffff; --fg:#0b0b0b; }
    html,body{height:100%}
    body{
      margin:0;
      background:#fff;
      color:var(--fg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      overflow:hidden;
    }

    .logo3d-wrap {
      position: relative;
      width: 100%;
      height: 100vh;
      background:#fff;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      overflow: hidden;
    }

    canvas{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%) scale(1.2);
      width:100%;
      height:100%;
      z-index:1;
      pointer-events:none;
    }

    #logo-fallback{
      position:absolute;
      top:50%;
      left:50%;
      transform:translate(-50%,-50%);
      max-width:60vw;
      z-index:0;
    }

    .botao{
      position:relative;
      z-index:3;
      margin-top:45vh;
    }
    .botao a{
      display:inline-block;
      background:#000;
      color:#fff;
      border:3px solid #000;
      text-decoration:none;
      padding:14px 28px;
      font-weight:600;
      font-size:14px;
      transition:0.3s;
    }
    .botao a:hover{
      background:#fff;
      color:#000;
    }

    .hint{
      position:absolute;
      bottom:40px;
      left:50%;
      transform:translateX(-50%);
      font-size:14px;
      color:#777;
      z-index:3;
    }

    @media(max-width:640px){
      canvas{
        transform:translate(-50%,-50%) scale(1);
      }
      #logo-fallback{
        max-width:70vw;
      }
      .botao{
        margin-top:40vh;
      }
      .botao a{
        padding:12px 20px;
        font-size:12px;
      }
      .hint{
        font-size:12px;
        bottom:20px;
      }
    }
  </style>

  <script type="importmap">
    {"imports":{
      "three":"https://unpkg.com/three@0.160.0/build/three.module.js",
      "three/addons/":"https://unpkg.com/three@0.160.0/examples/jsm/"
    }}
  </script>
</head>
<body>
  <div class="logo3d-wrap" id="logo3d">
    <img id="logo-fallback" src="logo-static.webp" alt="CARVA">

    <div class="botao">
      <a href="https://chat.whatsapp.com/H56m4OGC63F3HJ09ila6uv" target="_blank">
        ENTRAR NA COMUNIDADE CARVA
      </a>
    </div>

    <div class="hint">Nada que nos empreda sobrevive</div>
  </div>

  <script type="module">
    const CONFIG = {
      modelUrl: './logo3dpreta.gltf',
      resourcePath: './',
      crossOrigin: 'anonymous',
      initialScale: 1.0,
      rotateOnIdle: true,
    };

    import * as THREE from 'three';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';

    const wrap = document.getElementById('logo3d');
    const fallback = document.getElementById('logo-fallback');

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
    camera.position.set(0,0,3);

    const renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
    renderer.setPixelRatio(Math.min(window.devicePixelRatio,1.5));
    renderer.setSize(window.innerWidth, window.innerHeight);
    wrap.appendChild(renderer.domElement);

    const light = new THREE.DirectionalLight(0xffffff,1.5);
    light.position.set(2,3,5);
    scene.add(light);
    scene.add(new THREE.AmbientLight(0xffffff,0.6));

    const loader = new GLTFLoader();
    const draco = new DRACOLoader();
    draco.setDecoderPath('https://unpkg.com/three@0.160.0/examples/jsm/libs/draco/');
    loader.setDRACOLoader(draco);

    let group = new THREE.Group();
    scene.add(group);

    loader.load(CONFIG.modelUrl, gltf=>{
      const model = gltf.scene;
      model.scale.set(1,1,1);
      model.rotation.y = Math.PI * 0.1;
      group.add(model);
      fallback.style.display="none";
    });

    let isDown=false,lastX=0,lastY=0,vx=0,vy=0;
    const onDown=(x,y)=>{isDown=true;lastX=x;lastY=y;};
    const onMove=(x,y)=>{
      if(!isDown)return;
      const dx=x-lastX,dy=y-lastY;lastX=x;lastY=y;
      const k=0.005;
      vy=-dx*k;vx=-dy*k;
      group.rotation.y+=vy;group.rotation.x+=vx;
    };
    const onUp=()=>{isDown=false;};

    renderer.domElement.addEventListener('mousedown',e=>onDown(e.clientX,e.clientY));
    window.addEventListener('mousemove',e=>onMove(e.clientX,e.clientY));
    window.addEventListener('mouseup',onUp);
    renderer.domElement.addEventListener('touchstart',e=>{const t=e.touches[0];if(t)onDown(t.clientX,t.clientY);},{passive:true});
    renderer.domElement.addEventListener('touchmove',e=>{const t=e.touches[0];if(t)onMove(t.clientX,t.clientY);},{passive:true});
    renderer.domElement.addEventListener('touchend',onUp);

    window.addEventListener('resize',()=>{
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    const clock=new THREE.Clock();
    function animate(){
      const dt=clock.getDelta();
      if(!isDown){
        group.rotation.y += vy;
        group.rotation.x += vx;
        vy *= 0.94; vx *= 0.94;
        if(CONFIG.rotateOnIdle && Math.abs(vx)+Math.abs(vy)<0.0006) group.rotation.y+=0.003;
      }
      renderer.render(scene,camera);
      requestAnimationFrame(animate);
    }
    animate();
  </script>
</body>
</html>
